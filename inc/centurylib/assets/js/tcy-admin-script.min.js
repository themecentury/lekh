/*!
 * Admin script of centurylib
 * @package ThemeCentury
 * @subpackage centurylib
 */
!function(v){"use strict";var l,p=v(document);(l={Repeater:function(){var g=function(e){e.find("[name]").each(function(){v(this).trigger("change")})},i=function(){var e=v(".tcy-repeater");e.sortable({orientation:"vertical",items:"> .tcy-widget-repeater-table",placeholder:"te-sortable-placeholder",update:function(e,t){g(t.item)}}),e.trigger("sortupdate"),e.sortable("refresh")};p.on("widget-added widget-updated panelsopen",function(e,t){i()}),v(function(){"widgets"===window.pagenow&&v(".widgets-holder-wrap:not(#available-widgets)").find("div.widget").one("click.toggle-widget-expanded",function(){i()})}),p.on("click",".tcy-add-repeater",function(e){e.preventDefault();var t=v(this),i=t.closest(".tcy-repeater"),a=i.find(".tcy-code-for-repeater"),n=i.find(".tcy-total-repeater-counter"),o=parseInt(n.val()),c=a.html();n.val(o+1);var r,s,d,l,p=(r=c,s=t.attr("id"),d=o,l=new RegExp(s,"g"),r.replace(l,d));t.before(v('<div class="tcy-widget-repeater-table"></div>').append(p));var f=t.prev(".tcy-widget-repeater-table");f.find(".tcy-repeater-inside").slideDown("fast",function(){f.addClass("open"),g(f)})}),p.on("click",".tcy-repeater-top, .tcy-repeater-close",function(e){e.preventDefault();var t=v(this).closest(".tcy-widget-repeater-table"),i=t.find(".tcy-repeater-inside");i.is(":hidden")?i.slideDown("fast",function(){t.addClass("open")}):i.slideUp("fast",function(){t.removeClass("open")})}),p.on("click",".tcy-repeater-remove",function(e){e.preventDefault();var t=v(this),i=t.closest(".tcy-widget-repeater-table"),a=t.closest(".tcy-repeater");i.remove(),a.closest("form").trigger("change"),g(a)}),p.on("change",".te-select",function(e){e.preventDefault();var t=v(this),i=t.closest(".tcy-repeater-inside"),a=i.find(".te-postid"),n=i.find(".tcy-repeater-control-actions"),o=t.find("option:selected").val();0==o?a.remove():(a.remove(),v.ajax({type:"GET",data:{action:"teg_get_edit_post_link",id:o},url:ajaxurl,beforeSend:function(e,t){a.remove()},success:function(e){0!=e&&n.append(e)},error:function(e,t,i){console.log(e+" :: "+t+" :: "+i)}}))})},Snipits:{Variables:function(){v(window).width(),v(window).height()},Append_HTML:function(){if("undefined"!=typeof teg_theme_info_object){var e=teg_theme_info_object.count_actions_recommended;void 0!==e&&"0"!=e&&v("li.lekh-info-w-red-tab a").append('<span class="lekh-info-actions-count">'+e+"</span>")}},Color_Picker:function(i){var e={change:function(e,t){i.closest("form").trigger("change")}};i.wpColorPicker(e)},ImageUpload:function(e){e.preventDefault();var t=v(this).data("title"),i=v(this).data("button"),a=v(this).prev(),n=v(this).prev().prev().children("img"),o=v(this).siblings(".img-preview-wrap"),c=wp.media.frames.meta_image_frame=wp.media({title:t,button:{text:i},library:{type:"image"}});c.open(),c.on("select",function(){var e=c.state().get("selection").first().toJSON();a.val(e.url),null!=n&&(n.attr("src",e.url),o.show()),a.trigger("change")})},WidgetTab:function(e){var t,i;v(this).hasClass("nav-tab-active")||(i=v(this).data("id"),t=v(this).closest(".tcy-widget-field-tab-wraper"),v(this).addClass("nav-tab-active").siblings(".nav-tab").removeClass("nav-tab-active"),t.find(".tcy-tab-contents").removeClass("tcy-tab-active"),t.find(i).addClass("tcy-tab-active"))},Widget_Accordion:function(){var e=v(this).closest(".tcy-accordion-title");v(this).prop("checked")?(e.siblings(".teg-accordion-content").slideDown().removeClass("open close"),e.find(".teg-accordion-arrow").addClass("fa-angle-up").removeClass("fa-angle-down")):(e.siblings(".teg-accordion-content").slideUp().removeClass("open close"),e.find(".teg-accordion-arrow").addClass("fa-angle-down").removeClass("fa-angle-up"))},Widget_Relation_Action:function(e,t,i){var a=e.val();for(var n in"CHECKBOX"==e.prop("tagName")&&(a=e.is(":checkbox")&&e.is(":checked")?a:""),t){if("empty"==i||"exist"==i)a=i;else if("values"==i&&n!=a)continue;var o=t[n];for(var c in o){var r="."+o[c].join(", .");switch(c){case"show_fields":e.closest(".widget-content").find(r).removeClass("tcy-hidden-field");break;case"hide_fields":e.closest(".widget-content").find(r).addClass("tcy-hidden-field");break;default:console.warn("Action "+n+" case is not defined")}}}},Widget_Relation:function(e){var t=v(this),i=t.val();"CHECKBOX"==t.prop("tagName")&&(i=t.is(":checkbox")&&t.is(":checked")?i:"");var a=v(this).data("relations");if(a){var n=l.Snipits.Widget_Relation_Action;for(var o in a){var c=a[o];if(c)switch(o){case"exist":i&&n(t,{exist:c},o);break;case"empty":i||n(t,{empty:c},o);break;case"values":c&&n(t,c,o);break;default:console.warn("Relation key "+o+"is not found.")}}}},CustomizerIcons:function(){var e=v(this),t=e.closest(".tcy-icons-wrapper"),i=e.children("i").attr("class"),a=i.split(" ")[1];e.siblings().removeClass("selected"),e.addClass("selected"),t.find(".tcy-icon-value").val(a),t.find(".icon-preview").html('<i class="'+i+'"></i>'),t.find(".tcy-icon-value").trigger("change")},IconToggle:function(){var e=v(this).closest(".tcy-icons-wrapper"),t=e.find(".icons-list-wrapper"),i=e.find(".dashicons");t.is(":hidden")?(t.slideDown(),i.removeClass("dashicons-arrow-down"),i.addClass("dashicons-arrow-up")):(t.slideUp(),i.addClass("dashicons-arrow-down"),i.removeClass("dashicons-arrow-up"))},IconSearch:function(){var e=v(this),t=this.value;e.closest(".tcy-icons-wrapper").find(".icons-list-wrapper").find("i").each(function(){-1<v(this).attr("class").search(t)?v(this).parent(".single-icon").show():v(this).parent(".single-icon").hide()})},DismissRequiredActions:function(){var e=v(this).attr("id"),t=v(this).attr("data-action");v.ajax({type:"GET",data:{action:"teg_theme_info_update_recommended_action",id:e,todo:t},dataType:"html",url:teg_theme_info_object.ajaxurl,beforeSend:function(e,t){v(".lekh-info-tab-pane#actions_required h1").append('<div id="temp_load" style="text-align:center"><img src="'+teg_theme_info_object.template_directory+'/inc/lekh-info/images/ajax-loader.gif" /></div>')},success:function(e){location.reload(),v("#temp_load").remove()},error:function(e,t,i){console.log(e+" :: "+t+" :: "+i)}})},Widget_Change:function(e,t){var i=l.Snipits,a=v(t);a.find(".tcy_widget_field_relation").trigger("change"),i.Color_Picker(a.find(".tcy-color-picker")),a.hasClass("widget-dirty")&&(a.removeClass("widget-dirty"),a.find('input[type="submit"]').attr("disabled","disabled"))}},Click:function(){var e=l.Snipits,t=e.ImageUpload;p.on("click",".media-image-upload",t);var i=e.WidgetTab;p.on("click",".tcy-widget-tab-list .nav-tab",i);var a=e.Widget_Relation;v(document).on("change",".tcy_widget_field_relation",a),v(".tcy_widget_field_relation").trigger("change"),p.on("click",".media-image-remove",function(e){v(this).siblings(".img-preview-wrap").hide(),v(this).prev().prev().val("")});var n=e.CustomizerIcons;p.on("click",".tcy-icons-wrapper .single-icon",n);var o=e.IconToggle;p.on("click",".tcy-icons-wrapper .icon-toggle ,.tcy-icons-wrapper .icon-preview",o);var c=e.IconSearch;p.on("keyup",".tcy-icons-wrapper .icon-search",c);var r=e.DismissRequiredActions;v(".lekh-info-recommended-action-button,.reset-all").click(r);var s=e.Widget_Accordion;p.on("change",".tcy-accordion-title input",s);var d=e.Widget_Change;p.on("widget-added widget-updated panelsopen",d)},Ready:function(){var e=l,t=e.Snipits;e.Repeater(),t.Variables(),t.Append_HTML(),t.Color_Picker(v(".tcy-color-picker")),e.Click()},Load:function(){},Resize:function(){},Scroll:function(){},Init:function(){var e=l,t=e.Ready,i=e.Load,a=e.Resize,n=e.Scroll;v(document).ready(t),v(window).load(i),v(window).scroll(n),v(window).resize(a)}}).Init()}(jQuery);